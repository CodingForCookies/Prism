{% extends 'panel.html' %}
{% block content %}
<div class="text-center">
	<h3><i class="fa fa-asterisk text-yellow"></i> Prism <span id="process">is shutting down</span>...</h3>
		{{ include_static('images/loading.svg') }}
		<p>
			I will redirect you in a few moments.
		</p>
		<p>
			If not, click <a href="{{ url_for(return_url) }}">here</a> once you are sure I have completely started up.
		</p>
</div>
<script type="text/javascript">
		$(function() {
				action = 0;
				ping_location = window.location.pathname

				if(ping_location.indexOf('.') != -1)
					ping_location = ping_location.substring(0, ping_location.lastIndexOf('/'))

				function doCall() {
						if(action == -1)
								return;
						$.post(ping_location, { action: action }, function(data) {
								if(data == '0') {
										$('#process').html('is restarting');
										action = 1;
								}else if(data == '1') {
										$('#process').html('has started');
										action = -1;
										setTimeout(function() {
												window.location = '{{ url_for(return_url) }}';
										}, 1000);
								}
						}).always(function() {
								setTimeout(doCall, 500);
						});
				}

				doCall();
		})
</script>
{% endblock %}
