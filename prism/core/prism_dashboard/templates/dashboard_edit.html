{% extends 'panel.html' %}
{% block title %}Dashboard - Editor{% endblock %}
{% block title_right %}<small><a href="{{ url_for('dashboard.home') }}">{{ "dashboard.widgets.edit.done" | locale }}</a></small>{% endblock %}
{% block content %}
{% if widgets|length == 0 %}
	<div class="callout callout-info">
	<h4>{{ "dashboard.widgets.no.header" | locale }}</h4>
	<p>{{ "dashboard.widgets.no.body" | locale }}</p>
  </div>
{% else %}
	<style>
		#sortable { list-style-type: none; margin: 0; padding: 0; width: 100%; }
	</style>
	<ul id="sortable">
		{% for widget_id, widget, widget_config in widgets %}
			<li class="ui-state-default plugin" data-widget="{{ widget_id }}">
				<div class="row">
					<div class="box box-solid">
						<div class="box-header with-border">
							<h3 class="box-title">{{ widget_id }}</h3>
							<div class="pull-right">
								<input type="checkbox" class="shown" data-widget="{{ widget_id }}" {% if widget_config.shown %}checked{% endif %} />
							</div>
						</div>
						<div class="box-body no-padding">
							{{ widget.do_render() | safe }}
						</div>
					</div>
				</div>
			</li>
		{% endfor %}
	</ul>
	<script>
		$(function() {
			$('.shown').change(function() {
				$.post(window.location.pathname, { action: (this.checked ? 'show' : 'hide'), id: $(this).data('widget') });
			});

			$('#sortable').sortable({
				stop: function(event, ui) {
					var data = "";

					$(".plugin").each(function(i, el) {
						var ord = $(el).data('widget');
						data += ord + "=" + $(el).index() + ",";
					});

					$.post(window.location.pathname, { action: 'order', data: data });
				}
			});
			$('#sortable').disableSelection();
		});
	</script>
{% endif %}
{% endblock %}
