{% extends 'panel.html' %}
{% block title %}Installed Plugins{% endblock %}
{% block content %}
<div class="panel-group" id="plugins" role="tablist" aria-multiselectable="true">
	{% for plugin in plugins %}
		<div class="panel panel-{% if not plugin.info.dependencies_satisfied %}danger{% elif not plugin.info.enabled %}warning{% else %}default{% endif %}">
			<div class="panel-heading" role="tab" id="header-{{ plugin.id }}">
				<h4 class="panel-title">
					<a role="button" data-toggle="collapse" data-parent="#plugins" href="#plugin-{{ plugin.id }}">
						{{ plugin.info.name }} <small>v{{ plugin.info.version }}</small>
					</a>
					<span class="pull-right">
						{% if plugin.info.required %}<i class="fa fa-certificate" data-toggle="tooltip" data-placement="top" title="Required"></i>{% endif %}
						{% if not plugin.info.enabled %}<i class="fa fa-times" data-toggle="tooltip" data-placement="top" title="Disabled"></i>{% endif %}
						{% if not plugin.info.dependencies_satisfied %}<i class="fa fa-circle" data-toggle="tooltip" data-placement="top" title="Dependencies"></i>{% endif %}
					</span>
				</h4>
			</div>
			<div id="plugin-{{ plugin.id }}" class="panel-collapse collapse" role="tabpanel">
				<div class="panel-body">
					{% if not plugin.info.enabled %}
						<div class="alert alert-warning">This plugin is disabled.</div>
					{% endif %}
					{% if not plugin.info.dependencies_satisfied %}
						{% if plugin.info.enabled %}
							<div class="alert alert-danger">The plugin is enabled, but it's dependencies are unsatisfied! It has been disabled!</div>
						{% else %}
							<div class="alert alert-warning">This plugin's dependencies are unsatisfied.</div>
						{% endif %}
					{% else %}
						{% if plugin.info.required %}
							{% if plugin.active %}
								<div class="alert alert-info">This is a required plugin.</div>
							{% else %}
								<div class="alert alert-info">This is a required plugin, but it's disabled!</div>
							{% endif %}
						{% endif %}
					{% endif %}
					
					<span class="pull-right"><i>{{ plugin.id }}</i></span>
					<h4>Description</h4>
					{{ plugin.info.description }}
					
					{% if plugin.info.dependencies %}
						<hr />
						<h4>Dependencies</h4>
						<table class="table table-striped">
							<thead><tr><th>Type</th><th>Depends on</th></tr></thead>
							<tbody>
								{% for depend_type, depend_id, satisfied in plugin.info.dependencies %}
									<tr>
										<td>{{ depend_type }}</td>
										<td>{{ depend_id }}</td>
										<td>
											{% if depend_type == 'package' %}
												{% if satisfied %}
													Installed
												{% else %}
													Not Installed
													<a href="{{ url_install_application(depend_id, 'dashboard.plugins_list') }}" class="btn btn-sm btn-default pull-right"><i class="fa fa-download"></i> Download</a>
												{% endif %}
											{% else %}
												{% if satisfied %}
													Installed and Enabled
												{% else %}
													{% set found = [False] %}
													{% for plugin in plugins %}
														{% if plugin.id == depend_id %}
															{% if found.append(True) %}{% endif %}
															{% break %}
														{% endif %}
													{% endfor %}
													{% if found[1] %}
														Not Enabled
													{% else %}
														Not Installed
													{% endif %}
												{% endif %}
											{% endif %}
										</td>
									</tr>
								{% endfor %}
							</tbody>
						</table>
					{% endif %}
					
					{% if not plugin.info.required %}
						<hr />
						
						<form class="pull-right" method="POST">
							<input type="hidden" name="id" value="{{ plugin.id }}" />
							{% if not plugin.info.enabled %}
								<button class="btn btn-primary" name="action" value="enable" {% if not plugin.info.dependencies_satisfied %} data-toggle="tooltip" data-placement="top" title="Dependencies Unsatisfied" disabled{% endif %}>Enable</button>
							{% else %}
								<button class="btn btn-danger" name="action" value="disable">Disable</button>
							{% endif %}
						</form>
					{% endif %}
				</div>
			</div>
		</div>
	{% endfor %}
</div>
{% endblock %}